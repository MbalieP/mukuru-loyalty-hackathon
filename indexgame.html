<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mukuru Mystery Box</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        background: rgb(240 ,84 ,35);
        font-family: 'Segoe UI', sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: rgb(240 ,84 ,35);
        text-align: center;
        padding: 20px;
    }
    .container {
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 100%;
        box-shadow: 0 15px 30px rgba(0,0,0,0.5);
    }
    h1 { font-size: 2.8rem; margin-bottom: 10px; color: #FF9800; text-shadow: 0 2px 10px rgba(255,152,0,0.6); }
    .subtitle { font-size: 1.2rem; margin-bottom: 30px; color: #e0e0e0; }
    .box-container { position: relative; margin: 30px auto; width: 220px; height: 220px; perspective: 1000px; }
    #box {
        width: 100%; height: 100%;
        background: linear-gradient(145deg, #ff6600, #8B0000);
        color: white;
        border: 4px solid #FFD700;
        border-radius: 15px;
        display: flex; align-items: center; justify-content: center;
        font-size: 32px; font-weight: bold;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative; overflow: hidden;
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    }
    #box:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,102,0,0.8); }
    #box::before {
        content: ""; position: absolute; top: -50%; left: -50%;
        width: 200%; height: 200%;
        background: linear-gradient(to bottom right, rgba(255,255,255,0.2), rgba(255,255,255,0.1), rgba(255,255,255,0.05), transparent);
        transform: rotate(30deg); pointer-events: none;
    }
    #box::after {
        content: "M"; position: absolute;
        font-size: 120px; font-weight: bold;
        color: rgba(255,255,255,0.15);
        top: 50%; left: 50%; transform: translate(-50%,-50%);
        pointer-events: none;
    }
    .ribbon { position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; overflow: hidden; z-index: 2; }
    .ribbon span {
        position: absolute; top: 15px; right: -25px;
        transform: rotate(45deg);
        width: 100px; padding: 5px 0;
        background: #ff5e00; color: #994515;
        font-weight: bold; text-align: center;
        box-shadow: 0 5px 10px rgba(0,0,0,0.2); font-size: 14px;
    }
    #result {
        margin-top: 30px; font-size: 22px; min-height: 60px;
        padding: 15px; border-radius: 10px;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255,255,255,0.2);
        transition: all 0.3s ease;
    }
    .prize-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
    .prize-icon { font-size: 28px; color: #eb6a00; }
    .confetti { position: absolute; width: 10px; height: 10px; border-radius: 0; animation: confetti-fall 5s ease-in-out; opacity: 0.8; }
    @keyframes confetti-fall {
        0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
        100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
    }
    .shine { animation: shine 2s infinite; }
    @keyframes shine {
        0% { box-shadow: 0 0 15px rgba(255,152,0,0.6); }
        50% { box-shadow: 0 0 30px rgba(255,152,0,0.9), 0 0 60px rgba(255,152,0,0.6); }
        100% { box-shadow: 0 0 15px rgba(255,152,0,0.6); }
    }
    .winner-animation { animation: winner-pulse 1s infinite; }
    @keyframes winner-pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    @media (max-width:600px){.container{padding:20px;} h1{font-size:2.2rem;} .box-container{width:180px;height:180px;} #box{font-size:28px;}}
</style>
</head>
<body>
<div class="container">
    <h1>Mukuru Mystery Box</h1>
    <p class="subtitle">Click the box to reveal your prize!</p>
    <div class="box-container">
        <div class="ribbon"><span>NEW</span></div>
        <div id="box" class="shine">OPEN</div>
    </div>
    <div id="result"><p>Your prize awaits...</p></div>
</div>

<script>
const box = document.getElementById("box");
const result = document.getElementById("result");

// Your FastAPI backend endpoint
const apiUrl = "http://127.0.0.1:8000/open-box";

function createConfetti() {
    const colors = ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff'];
    const container = document.querySelector('.container');
    for (let i=0;i<50;i++){
        const c = document.createElement('div');
        c.className='confetti';
        c.style.left=Math.random()*100+'%';
        c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        c.style.width=(5+Math.random()*10)+'px';
        c.style.height=(5+Math.random()*10)+'px';
        c.style.animationDelay=Math.random()*5+'s';
        container.appendChild(c);
        setTimeout(()=>c.remove(),5000);
    }
}

box.addEventListener("click", async ()=>{
    box.style.transform="scale(0.95)";
    box.innerText="...";

    try {
        // send user_id as query param instead of JSON
        const response = await fetch(apiUrl + "?user_id=1", {
            method: "POST"
        });

        const data = await response.json();
        const prize = data.prize;

        setTimeout(()=>{
            result.innerHTML = `
                <p>üéâ Congratulations!</p>
                <div class="prize-container">
                    <i class="fas fa-gift prize-icon"></i>
                    <span>You won: <strong>${prize.label}</strong></span>
                </div>
            `;
            result.classList.add("winner-animation");
            createConfetti();
            box.innerText="OPEN"; 
            box.style.transform="scale(1)";
            setTimeout(()=>result.classList.remove("winner-animation"),3000);
        }, 1200);

    } catch (err) {
        console.error(err);
        result.innerHTML = "<p>‚ö†Ô∏è Error connecting to the server.</p>";
        box.innerText="OPEN"; 
        box.style.transform="scale(1)";
    }
});
</script>
</body>
</html>